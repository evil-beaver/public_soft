<modification>
    <name> Rest API opencart Module</name>
    <version>1.0</version>
    <author>Your Name</author>
    <link>https://yourwebsite.com</link>
    <code>api_clients</code>

    <!-- Добавляем пункт меню в админке -->
    <file path="admin/controller/common/column_left.php">
        <operation>
            <search><![CDATA[if ($this->user->hasPermission('access', 'extension/module')) {]]></search>
            <add position="after"><![CDATA[
                if ($this->user->hasPermission('access', 'extension/module/api_clients')) {
                    $module[] = array(
                        'name'     => 'API Clients',
                        'href'     => $this->url->link('extension/module/api_clients', 'user_token=' . $this->session->data['user_token'], true),
                        'children' => array()
                    );
                }
            ]]></add>
        </operation>
    </file>

    <!-- Создаем таблицы и добавляем начальные данные -->
    <file path="admin/model/setting/setting.php">
        <operation>
            <search><![CDATA[public function deleteSetting($code, $store_id = 0) {]]></search>
            <add position="before"><![CDATA[
                public function installModule($code) {
                    // Проверяем, существует ли таблица api_clients
                    $query = $this->db->query("SHOW TABLES LIKE '" . DB_PREFIX . "api_clients'");
                    if (!$query->num_rows) {
                        $this->db->query("
                            CREATE TABLE `" . DB_PREFIX . "api_clients` (
                                `client_id` INT AUTO_INCREMENT PRIMARY KEY,
                                `client_name` VARCHAR(255) NOT NULL,
                                `client_secret` VARCHAR(255) NOT NULL,
                                `status` TINYINT(1) NOT NULL DEFAULT 1,
                                `date_added` DATETIME NOT NULL
                            ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
                        ");
                    }

                    // Проверяем, существует ли таблица api_order_fields
                    $query = $this->db->query("SHOW TABLES LIKE '" . DB_PREFIX . "api_order_fields'");
                    if (!$query->num_rows) {
                        $this->db->query("
                            CREATE TABLE `" . DB_PREFIX . "api_order_fields` (
                                `field_id` INT AUTO_INCREMENT PRIMARY KEY,
                                `field_name` VARCHAR(128) NOT NULL,
                                `is_required` TINYINT(1) NOT NULL DEFAULT 0,
                                `date_added` DATETIME NOT NULL,
                                `date_modified` DATETIME NOT NULL
                            ) ENGINE=InnoDB DEFAULT CHARSET=utf8;
                        ");

                        // Добавляем начальные данные
                        $this->db->query("
                            INSERT INTO `" . DB_PREFIX . "api_order_fields` (`field_name`, `is_required`, `date_added`, `date_modified`)
                            VALUES ('customer_name', 1, NOW(), NOW()),
                                   ('email', 1, NOW(), NOW()),
                                   ('phone', 0, NOW(), NOW());
                        ");
                    }
                }

                public function uninstallModule($code) {
                    // Удаляем таблицы при деинсталляции
                    $this->db->query("DROP TABLE IF EXISTS `" . DB_PREFIX . "api_clients`");
                    $this->db->query("DROP TABLE IF EXISTS `" . DB_PREFIX . "api_order_fields`");
                }
            ]]></add>
        </operation>
    </file>
    <file path="admin/controller/extension/module/api_clients.php">
        <operation>
            <add><![CDATA[<?php // Файл api_clients.php добавлен успешно ]]></add>
        </operation>
    </file>
    <file path="admin/controller/extension/module/api_order_fields.php">
        <operation>
            <add><![CDATA[<?php // Файл api_order_fields.php добавлен успешно ]]></add>
        </operation>
    </file>
    <file path="catalog/controller/api/order.php">
        <operation>
            <add><![CDATA[<?php // Файл order.php добавлен успешно ]]></add>
        </operation>
    </file>
</modification>